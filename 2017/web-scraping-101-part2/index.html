<!doctype html><html prefix="og: http://ogp.me/ns#">
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Web Scraping 101 (part 2): Build an Anna University Result Scraper &#183; Aravind Vasudevan</title>
<meta name=description content="This is the follow-up to Web Scraping 101: Build a simple web scraper using PHP. If you haven&rsquo;t seen it yet, I&rsquo;d highly recommend you to read that before continuing.
In this tutorial, we will be building a simple web scraper that extracts the result from Anna University&rsquo;s website. This tutorial is strictly for educational purposes.
 AU Scraper We are going to do this in 4 simple steps:
Step 1: read the website and create the DOM Anna University provides a nice little endpoint using which we can view our result by sending a GET Request.">
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta name=generator content="Hugo 0.89.4">
<meta name=robots content="index,follow">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="Web Scraping 101 (part 2): Build an Anna University Result Scraper">
<meta property="og:description" content="This is the follow-up to Web Scraping 101: Build a simple web scraper using PHP. If you haven&rsquo;t seen it yet, I&rsquo;d highly recommend you to read that before continuing.
In this tutorial, we will be building a simple web scraper that extracts the result from Anna University&rsquo;s website. This tutorial is strictly for educational purposes.
 AU Scraper We are going to do this in 4 simple steps:
Step 1: read the website and create the DOM Anna University provides a nice little endpoint using which we can view our result by sending a GET Request.">
<meta property="og:type" content="article">
<meta property="og:url" content="/2017/web-scraping-101-part2/">
<link rel=stylesheet href=/dist/site.css>
<link rel=stylesheet href=/dist/syntax.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous>
</head>
<body>
<script type=application/javascript>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-83211075-2','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script>
<div id=wrapper>
<header class=site-header>
<div class=container>
<div class=site-title-wrapper>
<h1 class=site-title>
<a href=/>Yet another programmer's blog</a>
</h1>
<a class=button-square href=/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/AravindVasudev rel=me>
<i class="fa fa-github-alt" aria-hidden=true></i>
</a>
<a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/aravindvasudev/ rel=me>
<i class="fa fa-linkedin" aria-hidden=true></i>
</a>
<a class="button-square button-social hint--top" data-hint=Email aria-label="Send an Email" href=mailto:aravind_vasudevan@outlook.com>
<i class="fa fa-envelope" aria-hidden=true></i>
</a>
</div>
<ul class=site-nav>
<li class=site-nav-item>
<a href=/>Blog</a>
</li>
<li class=site-nav-item>
<a href=/about/>About</a>
</li>
</ul>
</div>
</header>
<div id=container>
<div class=container>
<article class=post-container itemscope itemtype=http://schema.org/BlogPosting>
<header class=post-header>
<h1 class=post-title itemprop="name headline">Web Scraping 101 (part 2): Build an Anna University Result Scraper</h1>
<p class=post-date>
<span>Published <time datetime=2017-01-14 itemprop=datePublished>Sat, Jan 14, 2017</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person>
<span itemprop=name>
<a href=https://github.com/AravindVasudev itemprop=url rel=author>Aravind Vasudevan</a>
</span>
</span>
</p>
<p class="post-reading post-line">
<span>Estimated reading time: 4 min</span>
</p>
</header>
<div class="post-content clearfix" itemprop=articleBody>
<p>This is the follow-up to <a href=../web-scraping-101/>Web Scraping 101: Build a simple web scraper using PHP</a>.
If you haven&rsquo;t seen it yet, I&rsquo;d highly recommend you to read that before continuing.</p>
<p>In this tutorial, we will be building a simple web scraper that extracts the
result from Anna University&rsquo;s website. This tutorial is strictly for educational
purposes.</p>
<hr>
<h2 id=au-scraper>AU Scraper</h2>
<p>We are going to do this in 4 simple steps:</p>
<h3 id=step-1-read-the-website-and-create-the-dom>Step 1: read the website and create the DOM</h3>
<p>Anna University provides a nice little endpoint using which we can view our result
by sending a GET Request.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=ss>http</span><span class=p>:</span><span class=sr>//</span><span class=n>aucoe</span><span class=o>.</span><span class=n>annauniv</span><span class=o>.</span><span class=n>edu</span><span class=o>/</span><span class=n>cgi</span><span class=o>-</span><span class=n>bin</span><span class=o>/</span><span class=n>result</span><span class=o>/</span><span class=n>cgrade</span><span class=o>.</span><span class=n>pl?regno</span><span class=o>=[</span><span class=n>register_number</span><span class=o>]</span>
</code></pre></div><p>If you have gone through the <a href=../web-scraping-101/>previous post</a>, the below needs no explanation.</p>
<p>Going through the source of the site, we can see that structure of the site is
pretty messed up. If you have tried running the above code, you&rsquo;d have noticed that
it throws many errors at <code>loadHTML()</code> line. This is because libxml library used by
PHP throws an error when the HTML it receives is not structured properly.</p>
<p><img src=/images/blog/auscraper_1.png alt></p>
<p>To get over this, we use <a href=http://php.net/manual/en/function.libxml-use-internal-errors.php><code>libxml_use_internal_errors()</code></a> function which stops the libxml from throwing errors to the standard error.</p>
<h3 id=step-2-extract-the-data>Step 2: Extract the data</h3>
<p>As we have seen already, the structure of the site is pretty messed up. So, we
need to find a pattern to extract the relevant data. Going through the site once
more, we can see that all the fields we need are enclosed within a <code>&lt;td></code> tag
with <code>bgcolor="#fffaea"</code> attribute.</p>
<p>To extract an element using its attribute, we can use <a href=http://php.net/manual/en/domxpath.query.php><code>query</code></a>
method of <a href=http://php.net/manual/en/class.domxpath.php><code>DOMXPath</code></a> class. <code>query</code>
method takes in a XPath(XPath is a query language for selecting nodes from an XML document.)
and returns a <a href=http://php.net/manual/en/class.domnodelist.php><code>DOMNodeList</code></a> similar
to <code>getElementsByTagName</code> in previous post.</p>
<p>The XPath query we will be using is</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=o>//</span><span class=n>td</span><span class=p>[</span><span class=nd>@bgcolor</span><span class=o>=</span><span class=s2>&#34;#fffaea&#34;</span><span class=p>]</span>
</code></pre></div><p>The above XPath query is broken down below:</p>
<table>
<thead>
<tr>
<th style=text-align:center>Expression</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>//</td>
<td>makes the selection throughout the document.</td>
</tr>
<tr>
<td style=text-align:center>td</td>
<td>selects all the <code>td</code> nodes.</td>
</tr>
<tr>
<td style=text-align:center>@</td>
<td>Selects attributes</td>
</tr>
<tr>
<td style=text-align:center>td[@bgcolor="#fffaea"]</td>
<td>Selects all <code>td</code> with <code>bgcolor="#fffaea"</code> attribute</td>
</tr>
</tbody>
</table>
<p>First, we have to create a <code>DOMXPath</code> object. <code>DOMXPath's</code> constructor takes in
<code>DOMDocument</code> object. Then, we have to call the <code>query</code> method with the above
XPath query.</p>
<p>In the above code, data inside each selected node is stored into an array.</p>
<p><img src=/images/blog/auscraper_2.png alt></p>
<h3 id=step-3-clean-the-data>Step 3: Clean the data</h3>
<p>Not all the data that we have retrieved is useful to us. Before we proceed to
generate excel, let us first sanitize the data a little more.</p>
<p>From the above code&rsquo;s result, we can clearly see that, from <code>$extracted[6]</code> to the
end of the array, every <code>3Nth element</code> is the subject code and <code>3N + 1th element</code>
is the grade.</p>
<p><img src=/images/blog/auscraper_3.png alt></p>
<h3 id=step-4-store-it-to-excel>Step 4: Store it to Excel</h3>
<p>There are various external libraries to do this, but for simplicity, we are doing
this with raw PHP.</p>
<p>To generate an excel file, first we need to include some headers.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-Type: application/vnd.ms-excel&#34;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-disposition: attachment; filename=result.xls&#34;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Pragma: no-cache&#34;</span><span class=p>);</span>
<span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Expires: 0&#34;</span><span class=p>);</span>
</code></pre></div><p>The explanation below can be skipped:</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Type: application/vnd.ms-excel</td>
<td>Sets the MIME Type for Excel</td>
</tr>
<tr>
<td>Content-disposition: attachment; filename=result.xls</td>
<td>Sets the file as downloadable with the name <code>result.xls</code></td>
</tr>
<tr>
<td>Pragma: no-cache</td>
<td>When the no-cache directive is present in a request message, an application SHOULD forward the request toward the origin server even if it has a cached copy of what is being requested.</td>
</tr>
<tr>
<td>Expires: 0</td>
<td>The Expires header contains the date/time after which the response is considered stale. Invalid dates, like the value 0, represent a date in the past and mean that the resource is already expired.</td>
</tr>
</tbody>
</table>
<p>Now, anything to the standard output will be stored as <code>.xls</code>. Each cell value
in a row is separated using tabs <code>\t</code> and each row is separated using line breaks <code>\n</code>.</p>
<p>example:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=n>echo</span> <span class=s1>&#39;Name&#39;</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span> <span class=o>.</span> <span class=s1>&#39;Phone&#39;</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
<span class=n>echo</span> <span class=s1>&#39;Joey Tribbiani&#39;</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\t</span><span class=s2>&#34;</span> <span class=o>.</span> <span class=s1>&#39;12345678&#39;</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</code></pre></div><p>will output:
<img src=/images/blog/auscraper_4.png alt></p>
<p>Now, storing <code>$result</code> to Excel:</p>
<p>will output:
<img src=/images/blog/auscraper_5.png alt></p>
<p>That&rsquo;s it, folks! We have successfully generated an Excel file with the scraped
result. If you have any problem following the tutorial, please do post it in the
comments below.</p>
<p>GITHUB link to the completed project: <a href=https://github.com/AravindVasudev/AUScraper>GITHUB</a></p>
</div>
<footer class="post-footer clearfix">
<p class=post-tags>
<span>Tagged:</span>
<a href=/tags/php/>php</a>,
<a href=/tags/web-scraping/>web scraping</a>
</p>
<div class=share>
<a class=icon-linkedin href="https://www.linkedin.com/shareArticle?mini=true&title=Web%20Scraping%20101%20%28part%202%29%3a%20Build%20an%20Anna%20University%20Result%20Scraper&url=%2f2017%2fweb-scraping-101-part2%2f&summary=" onclick="return window.open(this.href,'linkedin-share','width=554,height=481'),!1" aria-label="Share on LinkedIn">
<i class="fa fa-linkedin" aria-hidden=true></i>
</a>
</div>
</footer>
<div class=comments>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//aravind-vasudev-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</article>
</div>
</div>
</div>
<footer class=footer>
<div class=container>
<div class=site-title-wrapper>
<h1 class=site-title>
<a href=/>Yet another programmer's blog</a>
</h1>
<a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top">
<i class="fa fa-angle-up" aria-hidden=true></i>
</a>
</div>
<p class=footer-copyright>
<span>&copy; 2021 / Powered by <a href=https://gohugo.io/>Hugo</a></span>
</p>
<p class=footer-copyright>
<span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span>
</p>
</div>
</footer>
<script src=/js/jquery-1.11.3.min.js></script>
<script src=/js/jquery.fitvids.js></script>
<script src=/js/scripts.js></script>
</body>
</html>