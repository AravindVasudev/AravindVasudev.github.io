<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Undoing screw-ups in Mercurial &#183; Aravind Vasudevan</title>
<meta name=description content="In the last three months of using Mercurial at my internship, I have screwed up a lot of times. From adding wrong files to pushing bad commits, I have done it all. So, as the end of my internship is nearing, I&rsquo;m making a list of fixes that I learned during this journey.
Adding all files Most of us have a muscle memory of doing this:
git/hg add . git/hg commit -m &#34;foo&#34; git/hg push But if you are working on a legacy codebase which is as old as time itself, you will have to look twice for a ignore file before adding everything."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.122.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Undoing screw-ups in Mercurial"><meta property="og:description" content="In the last three months of using Mercurial at my internship, I have screwed up a lot of times. From adding wrong files to pushing bad commits, I have done it all. So, as the end of my internship is nearing, I&rsquo;m making a list of fixes that I learned during this journey.
Adding all files Most of us have a muscle memory of doing this:
git/hg add . git/hg commit -m &#34;foo&#34; git/hg push But if you are working on a legacy codebase which is as old as time itself, you will have to look twice for a ignore file before adding everything."><meta property="og:type" content="article"><meta property="og:url" content="/2018/undoing-screw-ups-in-hg/"><link rel=stylesheet href=/dist/site.css><link rel=stylesheet href=/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-83211075-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>Blog</a></h1><a class=button-square href=/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/AravindVasudev rel=me><i class="fa fa-github-alt" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://linkedin.com/in/aravindvasudev/ rel=me><i class="fa fa-linkedin" aria-hidden=true></i>
</a><a class="button-square button-social hint--top" data-hint=Email aria-label="Send an Email" href=mailto:aravind_vasudevan@outlook.com><i class="fa fa-envelope" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=/>Blog</a></li><li class=site-nav-item><a href=/misc/>Misc</a></li><li class=site-nav-item><a href=/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Undoing screw-ups in Mercurial</h1><p class=post-date><span>Published <time datetime=2018-03-26 itemprop=datePublished>Mon, Mar 26, 2018</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/AravindVasudev itemprop=url rel=author>Aravind Vasudevan</a></span></span></p><p class="post-reading post-line"><span>Estimated reading time: 2 min</span></p></header><div class="post-content clearfix" itemprop=articleBody><p>In the last three months of using Mercurial at my internship, I have screwed up a lot of times.
From adding wrong files to pushing bad commits, I have done it all. So, as the end of
my internship is nearing, I&rsquo;m making a list of fixes that I learned during this journey.</p><hr><h2 id=adding-all-files>Adding all files</h2><p>Most of us have a muscle memory of doing this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>git</span><span class=o>/</span><span class=nx>hg</span> <span class=nx>add</span> <span class=o>.</span>
</span></span><span class=line><span class=cl><span class=nx>git</span><span class=o>/</span><span class=nx>hg</span> <span class=nx>commit</span> <span class=o>-</span><span class=nx>m</span> <span class=s2>&#34;foo&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>git</span><span class=o>/</span><span class=nx>hg</span> <span class=nx>push</span>
</span></span></code></pre></div><p>But if you are working on a legacy codebase which is as old as time itself, you
will have to look twice for a ignore file before adding everything. Trust me on this,
you don&rsquo;t want to look like a halfwit who is just discovering what a version control is
at your internship.</p><p>But if you have mindlessly added everything, here is how you undo it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>hg</span> <span class=nx>update</span> <span class=o>-</span><span class=nx>C</span>
</span></span></code></pre></div><p>Beware: This removes all uncommitted changes. So backup your changes before you run this.</p><h2 id=ludicrous-changes>Ludicrous Changes</h2><p>Sometimes we do changes that make us question our own sanity. At times like these, all we
want is to revert back to the previous commit and pretend like nothing happened. Here is
how you do that:</p><h3 id=before-commit>Before Commit</h3><p>This is easy. you have done something ridiculous but were lucky enough to spot it
out before committing. Just run this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>hg</span> <span class=nx>update</span> <span class=o>-</span><span class=nx>C</span>
</span></span></code></pre></div><h3 id=after-commit>After Commit</h3><p>This is easy too. you have done something ridiculous and you committed. Just run this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>hg</span> <span class=nx>strip</span> <span class=s1>&#39;roots(outgoing())&#39;</span>
</span></span></code></pre></div><h3 id=after-push>After Push</h3><p>This is when you should consider a doctor and another job since doing a half-assed push as
an intern is the best way to get kicked out. Reverting pushed commits in Mercurial is
so convoluted that you might find a million different variation of doing it on the web.
Here is the one that worked for me:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>hg</span> <span class=k>clone</span> <span class=o>-</span><span class=nx>r</span> <span class=p>[</span><span class=nx>changeset</span><span class=p>]</span> <span class=p>[</span><span class=nx>repo</span><span class=p>]</span> <span class=p>[</span><span class=k>new</span><span class=o>-</span><span class=nx>directory</span><span class=p>]</span> <span class=c1># this is much quicker than cloning it from the server
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cp</span> <span class=p>[</span><span class=nx>repo</span><span class=p>]</span><span class=o>/.</span><span class=nx>hg</span><span class=o>/</span><span class=nx>hgrc</span> <span class=p>[</span><span class=k>new</span><span class=o>-</span><span class=nx>directory</span><span class=p>]</span><span class=o>/.</span><span class=nx>hg</span><span class=o>/</span>
</span></span></code></pre></div><p>Running this, you will end up with a new repo at the given changeset.</p><hr><p>And that&rsquo;s pretty much it. Hopefully, this was helpful.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/mercurial/>Mercurial</a></p><div class=share><a class=icon-linkedin href="https://www.linkedin.com/shareArticle?mini=true&title=Undoing%20screw-ups%20in%20Mercurial&url=%2f2018%2fundoing-screw-ups-in-hg%2f&summary=" onclick='return window.open(this.href,"linkedin-share","width=554,height=481"),!1' aria-label="Share on LinkedIn"><i class="fa fa-linkedin" aria-hidden=true></i></a></div></footer><div class=comments><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//aravind-vasudev-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>Blog</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2024 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span>SEND ANY CORRECTIONS/OPINIONS TO ARAVIND_VASUDEVAN [AT] OUTLOOK [DOT] COM</span></p></div></footer><script src=/js/jquery-1.11.3.min.js></script><script src=/js/jquery.fitvids.js></script><script src=/js/scripts.js></script></body></html>